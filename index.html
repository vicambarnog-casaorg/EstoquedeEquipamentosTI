<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Patrimônio - Dashboard</title>

  <!-- Firebase SDK (compat) - deve vir antes de firebase.js -->
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js"></script>

  <style>
    /* Clean dashboard styles - responsive */
    :root{
      --bg:#0b1220; --card:#0f1726; --accent:#6366f1; --muted:#94a3b8; --white:#e6eef8;
    }
    *{box-sizing:border-box;margin:0;padding:0}
    html,body{height:100%}
    body{font-family:Inter,Segoe UI,Roboto,Arial;background:#071029;color:var(--white);-webkit-font-smoothing:antialiased}
    .layout{display:grid;grid-template-columns:250px 1fr;min-height:100vh}
    .sidebar{background:linear-gradient(180deg,#07102a,#071f3a);padding:20px;border-right:1px solid rgba(255,255,255,0.03)}
    .brand{display:flex;gap:12px;align-items:center;margin-bottom:24px}
    .logo{width:44px;height:44px;border-radius:8px;background:var(--accent);display:flex;align-items:center;justify-content:center;font-weight:700}
    nav a{display:block;padding:10px;border-radius:8px;color:var(--muted);text-decoration:none;margin-bottom:6px}
    nav a.active,nav a:hover{background:rgba(255,255,255,0.02);color:var(--white)}
    .topbar{display:flex;justify-content:space-between;align-items:center;padding:16px;background:transparent;border-bottom:1px solid rgba(255,255,255,0.02)}
    .content{padding:20px}
    .card{background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));padding:16px;border-radius:10px;border:1px solid rgba(255,255,255,0.03)}
    .grid{display:grid;grid-template-columns:repeat(3,1fr);gap:16px;margin-bottom:16px}
    .btn{background:var(--accent);color:white;padding:8px 12px;border-radius:8px;border:none;cursor:pointer}
    .btn-ghost{background:transparent;color:var(--white);border:1px solid rgba(255,255,255,0.04);padding:8px 12px;border-radius:8px}
    input,textarea,select{width:100%;padding:8px;border-radius:8px;border:1px solid rgba(255,255,255,0.04);background:transparent;color:var(--white)}
    table{width:100%;border-collapse:collapse;color:var(--white)}
    th,td{padding:12px;border-bottom:1px solid rgba(255,255,255,0.03);text-align:left;font-size:14px}
    .photo-thumb{width:68px;height:48px;object-fit:cover;border-radius:6px;border:1px solid rgba(255,255,255,0.03)}
    .modal{position:fixed;inset:0;display:flex;align-items:center;justify-content:center;background:rgba(0,0,0,0.6);z-index:1000;visibility:hidden;opacity:0;transition:.15s}
    .modal.show{visibility:visible;opacity:1}
    .modal .body{background:#fff;padding:16px;border-radius:8px;color:#111}
    .small{color:var(--muted);font-size:13px}
    .hidden{display:none}
    @media(max-width:900px){.layout{grid-template-columns:1fr}.sidebar{display:none}}
    /* login centered box */
    #loginBox{max-width:360px;margin:80px auto;background:#fff;padding:20px;border-radius:10px;color:#111}
  </style>
</head>
<body>

  <!-- LOGIN -->
  <div id="loginBox">
    <h2>Entrar</h2>
    <p class="small">Use a conta demo ou crie no Firebase Auth</p>
    <div style="margin-top:12px">
      <input id="emailLogin" type="email" placeholder="E-mail" />
    </div>
    <div style="margin-top:8px">
      <input id="senhaLogin" type="password" placeholder="Senha" />
    </div>
    <div style="margin-top:12px;display:flex;gap:8px;justify-content:space-between">
      <button id="btnLogin" class="btn">Entrar</button>
      <button id="btnDemo" class="btn-ghost">Criar conta demo</button>
    </div>
    <div id="loginMsg" class="small" style="margin-top:8px;color:#b91c1c;display:none"></div>
  </div>

  <!-- DASHBOARD -->
  <div id="appLayout" class="layout hidden" aria-hidden="true">
    <aside class="sidebar">
      <div class="brand">
        <div class="logo">PT</div>
        <div>
          <div style="font-weight:700">Patrimônio</div>
          <div class="small">Painel administrativo</div>
        </div>
      </div>

      <nav>
        <a href="#" id="navProducts" class="active">Produtos</a>
        <a href="#" id="navSettings">Configurações</a>
      </nav>

      <div style="margin-top:auto">
        <div class="small" id="sidebarUser">Não logado</div>
        <div style="margin-top:10px">
          <button id="btnOpenLogin" class="btn-ghost">Entrar</button>
          <button id="btnLogout" class="btn hidden">Sair</button>
        </div>
      </div>
    </aside>

    <main>
      <div class="topbar">
        <div>
          <h2 id="pageTitle">Produtos</h2>
          <div class="small" id="productCount">0 produtos</div>
        </div>
        <div>
          <button id="btnNewProduct" class="btn">Novo produto</button>
        </div>
      </div>

      <div class="content">
        <div class="grid">
          <div class="card">
            <div class="small">Itens</div>
            <div style="font-size:20px;font-weight:700" id="statItems">0</div>
          </div>
          <div class="card">
            <div class="small">Fotos</div>
            <div style="font-size:20px;font-weight:700" id="statPhotos">0</div>
          </div>
          <div class="card">
            <div class="small">Usuário</div>
            <div style="font-size:16px" id="statUser">—</div>
          </div>
        </div>

        <div class="card" id="listCard">
          <h3>Lista de Produtos</h3>
          <table>
            <thead>
              <tr><th>Nº</th><th>Equipamento</th><th>Setor</th><th>Foto</th><th>Ações</th></tr>
            </thead>
            <tbody id="productTableBody">
              <tr><td colspan="5" class="small">Carregando...</td></tr>
            </tbody>
          </table>
        </div>

        <!-- product form modal -->
        <div id="productFormModal" class="modal" role="dialog" aria-hidden="true">
          <div class="body card" style="width:640px;max-width:95%;">
            <div style="display:flex;justify-content:space-between;align-items:center">
              <h3 id="formTitle">Novo Produto</h3>
              <div><button id="closeFormBtn" class="btn-ghost">Fechar</button></div>
            </div>

            <div style="margin-top:12px;display:grid;gap:8px">
              <label>Nº Patrimônio</label>
              <input id="numeroInput" />
              <label>Equipamento</label>
              <input id="equipamentoInput" />
              <label>Setor</label>
              <input id="setorInput" />
              <div style="display:flex;gap:8px;align-items:center">
                <button id="openCameraBtn" class="btn">Abrir câmera</button>
                <input id="fileInput" type="file" accept="image/*" multiple class="hidden" />
                <button id="selectFilesBtn" class="btn-ghost">Selecionar arquivos</button>
                <div style="flex:1"></div>
                <button id="saveProductBtn" class="btn">Salvar</button>
              </div>
              <div id="stagedPreview" style="display:flex;gap:8px;flex-wrap:wrap;margin-top:8px"></div>
            </div>
          </div>
        </div>

        <!-- product detail card -->
        <div id="productDetailCard" class="card hidden" style="margin-top:16px">
          <div style="display:flex;justify-content:space-between;align-items:center">
            <div>
              <h3 id="detailTitle">Detalhes</h3>
              <div class="small" id="detailSubtitle"></div>
            </div>
            <div style="display:flex;gap:8px">
              <button id="btnAddPhoto" class="btn">Adicionar foto</button>
              <button id="btnAddMaint" class="btn-ghost">Nova manutenção</button>
            </div>
          </div>

          <div style="margin-top:12px">
            <h4>Fotos</h4>
            <div id="detailPhotos" style="display:flex;gap:8px;flex-wrap:wrap"></div>
            <h4 style="margin-top:12px">Histórico</h4>
            <div id="maintenanceList" class="small">Nenhuma manutenção</div>
          </div>
        </div>

      </div>
    </main>
  </div>

  <!-- camera modal -->
  <div id="cameraModal" class="modal" role="dialog" aria-hidden="true">
    <div class="body">
      <div style="display:flex;justify-content:space-between;align-items:center">
        <h3>Câmera</h3>
        <div><button id="closeCameraBtn" class="btn-ghost">Fechar</button></div>
      </div>
      <div style="margin-top:8px">
        <video id="cameraVideo" autoplay playsinline style="width:100%;max-height:60vh;background:#000"></video>
      </div>
      <div style="margin-top:8px;display:flex;gap:8px;justify-content:flex-end">
        <button id="captureBtn" class="btn">Capturar</button>
      </div>
    </div>
  </div>

  <!-- maintenance modal -->
  <div id="maintModal" class="modal" role="dialog" aria-hidden="true">
    <div class="body">
      <div style="display:flex;justify-content:space-between;align-items:center">
        <h3>Adicionar manutenção</h3>
        <div><button id="closeMaintBtn" class="btn-ghost">Fechar</button></div>
      </div>
      <div style="margin-top:8px">
        <label>Data</label>
        <input id="maintDate" type="date" />
        <label style="margin-top:8px">Descrição</label>
        <textarea id="maintDesc" rows="3"></textarea>
        <div style="margin-top:8px;display:flex;justify-content:flex-end">
          <button id="saveMaintBtn" class="btn">Salvar</button>
        </div>
      </div>
    </div>
  </div>

  <!-- SCRIPTS -->
  <script src="firebase.js"></script>
  <script src="camera.js"></script>
  <script src="storage-cloudinary.js"></script>
  <script src="manutencao.js"></script>
  <script src="app.js"></script>
</body>
</html>
